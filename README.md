# ⚙️ AI 분석 시스템 성능 최적화 및 인프라 안정화 리포트

본 프로젝트는 AI 기반 사용자 분석 기능을 실서비스에 적용하며 발생한
다양한 운영 이슈들을 해결하고, 보다 **안정적이고 효율적인 예측 시스템**을 구축한 사례입니다.

## 📌 프로젝트 개요

* 일일 사용자 데이터를 기반으로 자동 분석을 수행하는 AI 시스템 운영
* 초기에는 모델 복잡도 및 트래픽 증가로 인한 CPU 과부하, 분석 중복 실행, 보안 이슈 발생
* 이를 해결하기 위한 **모델 경량화**, **분산 분석 처리**, **오토스케일링 최적화**, **분산 락 적용**, **보안 정책 강화** 수행

---

## 🚨 문제 1: 분석 로직 과부하로 인한 서버 불안정

### 🧩 원인

* 분석 로직이 복잡하여 **유저 1명당 CPU 사용률 90\~100%**
* 많은 유저가 동시에 분석을 요청하면 **CPU 폭주 + 인스턴스 부하**
* 오토스케일링은 CPU 70% 초과 시에만 작동 → **순간 부하 대응 지연**

### ✅ 해결 전략: 스케줄 기반 사전 확장 + 비동기 분석 구조

#### 🔧 분석 구조

* 매일 **자정**, 어제 접속한 유저를 기준으로 자동 분석 실행
* 유저 1명당 약 0.5\~1초 소요, CPU 1개 거의 전량 사용
* `CompletableFuture` 기반 비동기 체인 처리 (유저당 1 쓰레드)

#### 📈 오토스케일링 전략

| 시간    | 설정값                 | 설명                  |
| ----- | ------------------- | ------------------- |
| 23:55 | DesiredCapacity = 2 | 분석 시작 전, 인스턴스 2대 확보 |
| 00:00 | 분석 스케줄러 실행          | 자동 분석 시작            |
| 00:10 | DesiredCapacity = 1 | 분석 완료 후, 최소 인스턴스 유지 |

---

## 🔐 문제 2: 비밀번호 변경 후에도 기존 기기에서 로그아웃되지 않음

### 🧩 원인

* Access Token 만료 시 Refresh Token으로 자동 재발급
* 비밀번호 변경 후에도 기존 기기에 Refresh Token이 남아있어 **자동 로그인 유지**

### ✅ 해결 전략: Refresh Token 삭제 → 전 기기 자동 로그아웃

* **Redis에 유저별 Refresh Token 저장**
* 비밀번호 변경 시 해당 유저의 Refresh Token 삭제

```java
// 비밀번호 변경 시 실행
redisTemplate.delete("refreshToken:{userId}");
```

* 모든 기기에서 재로그인 요구 → **보안 강화**

---

## 🗂️ 문제 3: 오토스케일링 환경에서 배치 작업 중복 실행

### 🧩 원인

* 서비스는 오토스케일링 환경에서 여러 인스턴스로 운영 중
* 매일 자정 실행되는 **배치 분석 작업이 여러 인스턴스에서 동시에 실행**될 수 있음
* 이로 인해 **데이터 충돌, 중복 처리, 트래픽 폭주** 발생 가능

### ✅ 해결 전략: Redis 분산 잠금 + Readiness 상태 제어

#### 1️⃣ Redis 기반 분산 잠금

```java
if (redisTemplate.opsForValue().setIfAbsent("dailyAnalysisLock", "locked", 10, TimeUnit.MINUTES)) {
    // 잠금 획득 성공 → 분석 실행
}
```

* `setIfAbsent` 방식으로 **1개의 인스턴스만 분석 수행**
* 10분 타임아웃 설정으로 잠금 자동 해제

#### 2️⃣ Readiness 제어로 트래픽 차단

```java
readinessService.markReadinessDown(); // 분석 중 ALB 트래픽 차단
...
readinessService.markReadinessUp();   // 분석 완료 후 트래픽 재개
```

* `/actuator/health`의 Readiness 상태를 ALB가 체크
* 분석 중에는 `REFUSING_TRAFFIC` 상태로 설정 → **트래픽 안정화**

---

## 📊 종합 개선 효과

| 항목            | 문제 발생 전                  | 해결 후 개선 내용                        |
| ------------- | ------------------------ | --------------------------------- |
| 분석 로직 CPU 사용량 | 유저 1명당 90\~100% → 서버 불안정 | 비동기 처리 구조 도입 → 다수 유저 안정 처리 가능     |
| 오토스케일링 반응 지연  | 실시간 부하에 늦게 대응            | 스케줄 기반 사전 확장으로 선제적 대응             |
| 로그아웃 처리       | 비밀번호 변경 후에도 자동 로그인 유지    | Refresh Token 삭제로 모든 기기에서 자동 로그아웃 |
| 배치 중복 실행      | 다중 인스턴스에서 중복 처리          | Redis 락 + Readiness 제어로 단일 실행 보장  |

---

## 🔭 향후 계획

* 분석 로직 고도화를 위한 **하이퍼파라미터 튜닝 및 모델 경량화**
* 예측 정확도 개선을 위한 **데이터 증강(Data Augmentation)** 도입
* **MLOps 파이프라인 구축**으로 학습-배포 자동화 및 상태 모니터링 강화
* Readiness/Health 상태 기반 **모니터링 알림 시스템 연동**

---

> 본 리포트는 실제 서비스 운영 중 발생한 문제를 바탕으로 한
> **실전형 AI 분석 시스템 최적화 및 클라우드 인프라 대응 사례**입니다.
> 고부하 환경에서도 **실시간성, 보안성, 안정성**을 확보하는 데 중점을 두었습니다.
